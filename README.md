# GitHub Dependency Graph Gradle Plugin

A Gradle plugin for generating a GitHub dependency graph for a Gradle build, which can be uploaded to the [GitHub Dependency Submission API](https://docs.github.com/en/rest/dependency-graph/dependency-submission).

## Usage
This plugin is designed to be used in a GitHub Actions workflow, with support coming in a future release of the [Gradle Build Action](https://github.com/gradle/gradle-build-action).

For other uses, the [core plugin](https://plugins.gradle.org/plugin/org.gradle.github-dependency-graph-gradle-plugin) (`org.gradle.github.GitHubDependencyGraphPlugin`) 
should be applied to the `Gradle` instance via a Gradle init script as follows:

```
import org.gradle.github.GitHubDependencyGraphPlugin
initscript {
  repositories {
    maven {
      url = uri("https://plugins.gradle.org/m2/")
    }
  }
  dependencies {
    classpath("org.gradle:github-dependency-graph-gradle-plugin:+")
  }
}
apply plugin: GitHubDependencyGraphPlugin
```

This causes 2 separate plugins to be applied, that can be used independently:
- `GitHubDependencyExtractorPlugin` collects all dependencies that are resolved during a build execution and writes these to a file. The output file can be found at `<root>/build/reports/github-depenency-graph-snapshots/<job-correlator>.json`.
- `ForceDependencyResolutionPlugin` creates a `GitHubDependencyGraphPlugin_generateDependencyGraph` task that will attempt to resolve all dependencies for a Gradle build, by simply invoking `dependencies` on all projects.

### Required environment variables

The following environment variables configure the snapshot generated by the `GitHubDependencyExtractorPlugin`. See the [GitHub Dependency Submission API docs](https://docs.github.com/en/rest/dependency-graph/dependency-submission?apiVersion=2022-11-28) for details:
- `GITHUB_JOB_CORRELATOR`: Sets the `job.correlator` value for the dependency submission
- `GITHUB_JOB_ID`: Sets the `job.id` value for the dependency submission
- `GITHUB_REF`: Sets the `ref` value for the dependency submission
- `GITHUB_SHA`: Sets the `sha` value for the dependency submission
- `GITHUB_WORKSPACE`: Sets the root directory of the github repository
- `DEPENDENCY_GRAPH_REPORT_DIR` (optional): Specifies where the dependency graph report will be generated

Each of these values can also be provided via a system property. 
The equivalent system property name is lower case, with '_' replaced by '-'. 
eg: Env var `DEPENDENCY_GRAPH_REPORT_DIR` can be set as `-Ddependency-graph-report-dir=foo` on the command-line.

### Filtering which Gradle Configurations contribute to the dependency graph

If you do not want to include every dependency configuration in every project in your build, you can limit the
dependency extraction to a subset of these.

To restrict which Gradle subprojects contribute to the report, specify which projects to include via a regular expression.
You can provide this value via the `DEPENDENCY_GRAPH_INCLUDE_PROJECTS` environment variable, or the `dependency-graph-include-projects` System property.

To restrict which Gradle configurations contribute to the report, you can filter configurations by name using a regular expression.
You can provide this value via the `DEPENDENCY_GRAPH_INCLUDE_CONFIGURATIONS` environment variable, or the `dependency-graph-include-configurations` System property.

## Building/Testing

To build and test this plugin, run the following task:
```shell
./gradlew check
```

To self-test this plugin and generate a dependency graph for this repository, run:
```shell
./plugin-self-test-local
```

The generated dependency graph will be submitted to GitHub only if you supply a
[GitHub API token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token)
via the environment variable `GITHUB_TOKEN`.
